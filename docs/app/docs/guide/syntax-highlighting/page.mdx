---

icon: StarsIcon
---

import { OptionTable } from 'components/_table'
import { compileMdx } from 'nextra/compile'
import { MDXRemote } from 'nextra/mdx-remote'

# 语法高亮

Nextra 使用 [Shiki](https://shiki.style) 在构建时进行语法高亮，该方案非常可靠且性能优异。例如，在 Markdown 文件中添加以下内容：

````md copy=false filename="Markdown"
```js
console.log('hello, world')
```
````

将呈现为：

```js copy=false
console.log('hello, world')
```

## 功能特性

### 行内代码

通过 `{:}` 语法也支持行内语法高亮，例如 `let x = 1{:jsx}`：

```md copy=false filename="Markdown"
Inlined syntax highlighting is also supported `let x = 1{:jsx}` via:
```

### 高亮指定行

可通过在代码块添加 `{}` 属性来高亮特定代码行：

````md copy=false filename="Markdown"
```js {1,4-5}
import { useState } from 'react'

function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}
```
````

效果：

```js copy=false {1,4-5}
import { useState } from 'react'

function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}
```

### 高亮子字符串

通过在代码块添加 `//` 属性可高亮特定子字符串：

````md copy=false filename="Markdown"
```js /useState/
import { useState } from 'react'

function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}
```
````

```js copy=false /useState/
import { useState } from 'react'

function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}
```

若只需高亮部分匹配项，可添加数字标识：`/str/1`，或多个标识：`/str/1-3`，`/str/1,3`。

### 复制按钮

添加 `copy` 属性后，当用户悬停在代码块上时将显示复制按钮：

````md copy=false filename="Markdown"
```js copy
console.log('hello, world')
```
````

渲染效果：

```js copy
console.log('hello, world')
```

> [!NOTE]
>
> 可通过在 Nextra 配置文件（`next.config.mjs`）中设置 `defaultShowCopyCode: true` 全局启用此功能。全局启用后，仍可通过 `copy=false` 属性局部禁用。

### 行号显示

通过添加 `showLineNumbers` 属性可为代码块添加行号：

````md copy=false filename="Markdown"
```js showLineNumbers
import { useState } from 'react'

function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}
```
````

渲染效果：

```js copy=false showLineNumbers
import { useState } from 'react'

function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}
```

### 文件名与标题

通过添加 `filename` 属性可为代码块添加文件名或标题：

````md copy=false filename="Markdown"
```js filename="example.js"
console.log('hello, world')
```
````

渲染效果：

```js copy=false filename="example.js"
console.log('hello, world')
```

### ANSI 高亮

支持高亮 ANSI 转义码：

<ANSI />

export async function ANSI() {
  const rawAnsi = `\`\`\`ansi
[0m [0;32m✓[0m [0;2msrc/[0mindex[0;2m.test.ts (1)[0m
  [0;2m Test Files [0m [0;1;32m1 passed[0;98m (1)[0m
  [0;2m      Tests [0m [0;1;32m1 passed[0;98m (1)[0m
  [0;2m   Start at [0m 23:32:41
  [0;2m   Duration [0m 11ms
  [42;1;39;0m PASS [0;32m Waiting for file changes...[0m
         [0;2mpress [0;1mh[0;2m to show help, press [0;1mq[0;2m to quit
\`\`\``
  const rawJs = await compileMdx(`~~~md filename="Markdown"
${rawAnsi}
~~~

Renders:

${rawAnsi}
`)
  return <MDXRemote compiledSource={rawJs} />
}

## 支持的语言

查看[此列表](https://github.com/shikijs/shiki/blob/main/docs/languages.md)获取所有支持的语言。

{/* ## Customize the Theme */}

{/* Nextra uses CSS variables to define the colors for tokens. */}

## 动态内容处理

由于语法高亮在构建时完成，您不能在代码块中使用动态内容。不过，借助MDX的强大功能，可以通过客户端JavaScript实现变通方案。例如：

import { DynamicCode } from './_dynamic-code'

<DynamicCode>
```js copy=false filename="dynamic-code.js"
function hello() {
  const x = 2 + 3
  console.log(1)
}
```
</DynamicCode>

该方案存在局限性：更新后的内容不会重新高亮显示。例如若将数字改为`1 + 1`，高亮效果将不正确。

查看[代码示例](https://github.com/shuding/nextra/blob/main/docs/app/docs/guide/syntax-highlighting/_dynamic-code.tsx)了解实现原理。

## 禁用语法高亮

您可以选择禁用内置语法高亮功能以使用自定义方案。通过在Nextra配置文件中（`next.config.mjs`）设置`codeHighlight: false`可全局禁用语法高亮。

<OptionTable
  options={[
    [
      'codeHighlight',
      'boolean',
      'Enable or disable syntax highlighting. Defaults to `true`.'
    ]
  ]}
/>

## 自定义语法规则

Shiki支持通过[VSCode TextMate语法规则](https://code.visualstudio.com/api/language-extensions/syntax-highlight-guide)实现自定义语言的语法高亮。

您可以在Nextra配置的`mdxOptions.rehypePrettyCodeOptions`选项中覆写`getHighlighter`函数来提供这些语法规则（配置位于`next.config.mjs`）：

```js copy=false filename="next.config.mjs" {13-18}
import { BUNDLED_LANGUAGES } from 'shiki'

nextra({
  // ... other Nextra config options
  mdxOptions: {
    rehypePrettyCodeOptions: {
      getHighlighter: options =>
        getHighlighter({
          ...options,
          langs: [
            ...BUNDLED_LANGUAGES,
            // custom grammar options, see the Shiki documentation for how to provide these options
            {
              id: 'my-lang',
              scopeName: 'source.my-lang',
              aliases: ['mylang'], // Along with id, aliases will be included in the allowed names you can use when writing Markdown
              path: '../../public/syntax/grammar.tmLanguage.json'
            }
          ]
        })
    }
  }
})
```

## 自定义主题

在 `mdxOptions.rehypePrettyCodeOptions` 中，您也可以提供自定义主题，而无需[依赖 CSS 变量](/docs/guide/syntax-highlighting)：

```js copy=false filename="next.config.mjs" {4}
nextra({
  // ... other Nextra config options
  mdxOptions: {
    rehypePrettyCodeOptions: {
      // VSCode theme or built-in Shiki theme, see Shiki documentation for more information
      theme: JSON.parse(
        readFileSync('./public/syntax/arctis_light.json', 'utf8')
      )
    }
  }
})
```

### 多主题（深色与浅色模式）

将您的主题传递给 `theme` 参数，其中键名代表色彩模式：

```js copy=false filename="next.config.mjs" {5-8}
nextra({
  // ... other Nextra config options
  mdxOptions: {
    rehypePrettyCodeOptions: {
      theme: {
        dark: 'nord',
        light: 'min-light'
      }
    }
  }
})
```